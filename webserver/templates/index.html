{% set day_names = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] %}
{% set day_order = [6, 0, 1, 2, 3, 4, 5] %}

<!DOCTYPE html>
<html class="{{ door_state }}">
<head>
    <title>Doortron</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="refresh" content="30">

    <style>
        :root.unknown {
            --bg: #444;
            --fg: white;
        }
        :root.open {
            --bg: #006400;
            --fg: white;
        }
        :root.closed {
            --bg: #8b0000;
            --fg: white;
        }

        :root {
            color: var(--fg);
            background: var(--bg);
            font-family: sans-serif;
        }

        p, h1, h2 {
            width: 100%;
            text-align: center;
            margin-top: 0;
            margin-bottom: 15pt;
            font-size: 15pt;
        }

        h2 {
            font-size: 35pt;
        }

        table {
            margin: 0 auto;
            overflow-y: scroll;
        }

        td {
            width: 6em;
            height: 1em;
        }

        .top {
            font-weight: bold;
            font-size: 35pt;
        }

        .bottom {
            font-weight: bold;
            font-size: 65pt;
        }

        .now {
            background: #AA6C39;
        }
    </style>
</head>

<body>
    <div>
        {% if door_state == "unknown" %}
            <p>
                The DoorTron system is currently offline, if this persists for more than 5 minutes please notify an officer
            </p>
        {% else %}
            <h1 class="top">
                Roboclub is...
            </h1>

            <p class="bottom">
                {{ door_state.upper() }}
            </p>

            <p>(last updated {{ last_updated.strftime("%-I:%M %p, %b %-d") }})</p>

            <p>
                {% if door_state == "open" %}
                    This means there's an officer at the club, feel free to drop by :D
                {% elif door_state == "open" %}
                    Contact an officer if you would like to get into the club.
                {% endif %}
            </p>
        {% endif %}

        <h2>Heatmap</h2>
        <p>(Purple = Closed, Yellow = Open)</p>
        <table>
            <colgroup>
                <col></col>
                {% for day in day_order %}
                    <col {% if now.weekday() == day %}class="now"{% endif %}></col>
                {% endfor %}
            </colgroup>
            <tr>
                <th scope="col">Hour</th>

                {% for day in day_order %}
                    <th scope="col">{{ day_names[day] }}</th>
                {% endfor %}
            </tr>

            {% for hour in range(0, 24) %}
                <tr {% if now.hour == hour %}class="now"{% endif %}>
                    <th scope="row">{{ "{:02}".format(hour) }}:00</th>

                    {% for day in day_order %}
                        <td style="background: {{ heatmap[day, hour] }}"></td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    </div>
</body>
</html>
